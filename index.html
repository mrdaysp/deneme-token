<!DOCTYPE html>
<html>
<head>
    <title>Token Satın Al</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
    <h1>TOKEN SATIN AL</h1>
    <input type="number" id="tokenAmount" placeholder="Token Miktarı">
    <button onclick="calculate()">Hesapla</button>
    <p id="bnbAmount"></p>
    <button onclick="buyTokens()" style="display:none;">Satın Al</button>

    <script>
        const tokenSaleAddress = "DEPLOY_EDILEN_KONTRAT_ADRESI";
        const tokenSaleABI = [[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenAmount",
				"type": "uint256"
			}
		],
		"name": "buyTokens",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_tokenAddress",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_projectWallet",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_priceFeed",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "address",
				"name": "buyer",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "bnbAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			}
		],
		"name": "TokensPurchased",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_tokenAmount",
				"type": "uint256"
			}
		],
		"name": "calculateRequiredBNB",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "FEE_PERCENT",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBNBPrice",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "PROJECT_WALLET",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "TOKEN",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "TOKEN_PRICE_USD",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]];
        let web3;

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
            }
        }

        async function calculate() {
            await connectWallet();
            const tokenAmount = document.getElementById("tokenAmount").value;
            const tokenSale = new web3.eth.Contract(tokenSaleABI, tokenSaleAddress);
            
            const requiredBNB = await tokenSale.methods.calculateRequiredBNB(tokenAmount).call();
            document.getElementById("bnbAmount").innerText = `Ödenecek BNB: ${requiredBNB / 1e18}`;
            document.querySelector("button[onclick='buyTokens()']").style.display = "block";
        }

        async function buyTokens() {
            const tokenAmount = document.getElementById("tokenAmount").value;
            const accounts = await web3.eth.getAccounts();
            
            const tokenSale = new web3.eth.Contract(tokenSaleABI, tokenSaleAddress);
            await tokenSale.methods.buyTokens(tokenAmount).send({
                from: accounts[0],
                value: document.getElementById("bnbAmount").innerText.split(": ")[1] * 1e18
            });
            
            alert("Satın alma başarılı!");
        }
    </script>
</body>
</html>
